function displayPredictionSummary(predictions){if(!predictions||!predictions.most_confident_bet){return}const mostConfidentMarket=predictions.most_confident_bet.market;const mostConfidentPrediction=predictions.most_confident_bet.prediction;const mostConfidentProbability=predictions.most_confident_bet.probability;let formattedMarket=getMarketNameTurkish(mostConfidentMarket);let formattedPrediction=formatPrediction(mostConfidentMarket,mostConfidentPrediction);$('#predictionSummary').html(`<p class="mt-3">En yüksek olasılıklı tahmin:${formattedMarket}-${formattedPrediction}(${mostConfidentProbability}%)</p>`)}function formatHalfTimeFullTime(htft){if(!htft)return '';const parts=htft.split('/');if(parts.length!==2)return htft;let ilkYari='';let macSonu='';if(parts[0]==='HOME_WIN'||parts[0]==='MS1'){ilkYari='Ev'}else if(parts[0]==='DRAW'||parts[0]==='X'){ilkYari='Beraberlik'}else if(parts[0]==='AWAY_WIN'||parts[0]==='MS2'){ilkYari='Deplasman'}else{ilkYari=parts[0]}if(parts[1]==='HOME_WIN'||parts[1]==='MS1'){macSonu='Ev'}else if(parts[1]==='DRAW'||parts[1]==='X'){macSonu='Beraberlik'}else if(parts[1]==='AWAY_WIN'||parts[1]==='MS2'){macSonu='Deplasman'}else{macSonu=parts[1]}return `${ilkYari}/${macSonu}`}document.addEventListener('DOMContentLoaded',function(){const currentPath=window.location.pathname;document.querySelectorAll('.nav-link').forEach(link=>{if(link.getAttribute('href')===currentPath){link.classList.add('active')}});var tooltipTriggerList=[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));tooltipTriggerList.map(function(tooltipTriggerEl){return new bootstrap.Tooltip(tooltipTriggerEl)});function handleWidgetError(widget,error){console.error('Widget yüklenirken hata:',widget.id,error);widget.innerHTML='<div class="alert alert-danger" role="alert">'+'<i class="fas fa-exclamation-triangle me-2"></i>'+'Veriler yüklenirken bir hata oluştu. Lütfen sayfayı yenileyiniz.<br>'+'<small class="text-muted">Hata detayı:'+(error.message||'Bilinmeyen hata')+'</small>'+'</div>'}document.querySelectorAll('.api_football_loader').forEach(widget=>{console.log('Widget başlatılıyor:',widget.id);const loadingDiv=document.createElement('div');loadingDiv.className='text-center my-3';loadingDiv.innerHTML='<div class="spinner-border text-primary" role="status">'+'<span class="visually-hidden">Yükleniyor...</span></div>'+'<div class="mt-2 small text-muted">Veriler yükleniyor...</div>';widget.appendChild(loadingDiv);widget.addEventListener('error',function(e){console.error('Widget yükleme hatası:',e);handleWidgetError(this,e)})});window.addEventListener('error',function(e){if(e.target&&e.target.classList&&e.target.classList.contains('api_football_loader')){console.error('Global widget hatası:',e);handleWidgetError(e.target,e)}},true);const widgetScript=document.querySelector('script[src*="widgets.js"]');if(widgetScript){widgetScript.addEventListener('load',function(){console.log('Widget script başarıyla yüklendi')});widgetScript.addEventListener('error',function(e){console.error('Widget script yüklenirken hata oluştu:',e);document.querySelectorAll('.api_football_loader').forEach(widget=>{handleWidgetError(widget,e)})})}const searchInput=document.getElementById('searchInput');function searchFixtures(){const searchValue=searchInput ? searchInput.value.toLowerCase():'';document.querySelectorAll('.league-section').forEach(section=>{const leagueName=section.querySelector('.league-header').textContent.toLowerCase();const matches=section.querySelectorAll('.match-item');let sectionVisible=false;matches.forEach(match=>{const homeTeam=match.getAttribute('data-home-name').toLowerCase();const awayTeam=match.getAttribute('data-away-name').toLowerCase();const matchesSearch=leagueName.includes(searchValue)||homeTeam.includes(searchValue)||awayTeam.includes(searchValue);if(matchesSearch||!searchValue){match.style.display='';sectionVisible=true}else{match.style.display='none'}});section.style.display=sectionVisible ? '':'none'})}if(searchInput){searchInput.addEventListener('input',searchFixtures);searchInput.addEventListener('keyup',function(event){if(event.key==='Enter'){searchFixtures()}})}});function formatPrediction(betType,prediction){switch(betType){case 'over_2_5_goals':case '2.5_üst_alt':if(prediction==='YES'||prediction==='2.5 ÜST')return '2.5 ÜST';if(prediction==='NO'||prediction==='2.5 ALT')return '2.5 ALT';return prediction;case 'over_3_5_goals':case '3.5_üst_alt':if(prediction==='YES'||prediction==='3.5 ÜST')return '3.5 ÜST';if(prediction==='NO'||prediction==='3.5 ALT')return '3.5 ALT';return prediction;case 'both_teams_to_score':case 'kg_var_yok':if(prediction==='YES'||prediction==='KG VAR')return 'KG VAR';if(prediction==='NO'||prediction==='KG YOK')return 'KG YOK';return prediction;case 'match_result':case 'maç_sonucu':switch(prediction){case 'HOME_WIN':return 'MS1';case 'DRAW':return 'X';case 'AWAY_WIN':return 'MS2';case 'MS1':return 'MS1';case 'X':return 'X';case 'MS2':return 'MS2';default:return prediction}case 'first_goal':case 'ilk_gol':if(prediction==='HOME')return 'EV';if(prediction==='AWAY')return 'DEP';if(prediction==='NO_GOAL')return 'GOL YOK';if(prediction===undefined)return 'Belirsiz';if(typeof prediction==='object'&&prediction!==null){if(prediction.team){if(prediction.team==='HOME')return 'EV';if(prediction.team==='AWAY')return 'DEP';return 'GOL YOK'}}return 'İlk Gol';case 'half_time_full_time':case 'ilk_yarı_maç_sonu':return prediction.split('/').map(result=>{switch(result){case 'HOME_WIN':case 'MS1':return 'MS1';case 'DRAW':case 'X':return 'X';case 'AWAY_WIN':case 'MS2':return 'MS2';default:return result}}).join('/');default:if(prediction==='YES')return 'VAR';if(prediction==='NO')return 'YOK';return prediction}}function findMostConfidentBet(predictions){const excludedMarkets=['first_goal','first_goal_team','over_3_5_goals'];if(!predictions||!predictions.betting_predictions)return null;const allBets=predictions.betting_predictions;let highest={market:'',prediction:'',probability:0};for(const market in allBets){if(excludedMarkets.includes(market))continue;if(allBets[market]&&allBets[market].probability>highest.probability){highest={market:market,prediction:allBets[market].prediction,probability:allBets[market].probability}}}return highest}function getMarketNameTurkish(market){switch(market){case 'match_result':return 'Maç Sonucu';case 'both_teams_to_score':return 'KG VAR/YOK';case 'over_2_5_goals':return '2.5 Alt/Üst';case 'over_3_5_goals':return '3.5 Alt/Üst';case 'exact_score':return 'Kesin Skor';case 'half_time_full_time':return 'İlk Yarı/Maç Sonu';case 'first_goal':return 'İlk Gol';case 'first_goal_team':return 'İlk Golü Atacak Takım';case 'cards_over_3_5':return 'Kart 3.5 Alt/Üst';case 'corners_over_9_5':return 'Korner 9.5 Alt/Üst';default:return market}}function showPrediction(homeTeamId,awayTeamId,homeTeamName,awayTeamName,isRefresh=false){console.log("showPrediction çağrıldı:",{homeTeamId,awayTeamId,homeTeamName,awayTeamName});if(typeof window.showPrediction!=='undefined'){window.showPrediction(homeTeamId,awayTeamId,homeTeamName,awayTeamName,isRefresh)}else{console.error("Global showPrediction fonksiyonu bulunamadı")}}function formatPrediction(type,prediction){switch(type){case 'over_2_5_goals':case '2.5_üst_alt':if(prediction==='YES'||prediction==='2.5 ÜST')return '2.5 ÜST';if(prediction==='NO'||prediction==='2.5 ALT')return '2.5 ALT';return prediction;case 'over_3_5_goals':case '3.5_üst_alt':if(prediction==='YES'||prediction==='3.5 ÜST')return '3.5 ÜST';if(prediction==='NO'||prediction==='3.5 ALT')return '3.5 ALT';return prediction;case 'both_teams_to_score':case 'kg_var_yok':if(prediction==='YES'||prediction==='KG VAR')return 'KG VAR';if(prediction==='NO'||prediction==='KG YOK')return 'KG YOK';return prediction;case 'match_result':case 'maç_sonucu':switch(prediction){case 'HOME_WIN':return 'MS1';case 'DRAW':return 'X';case 'AWAY_WIN':return 'MS2';case 'MS1':return 'MS1';case 'X':return 'X';case 'MS2':return 'MS2';default:return prediction}default:if(prediction==='YES')return 'VAR';if(prediction==='NO')return 'YOK';return prediction}}function refreshPrediction(homeTeamId,awayTeamId,homeTeamName,awayTeamName){$('#predictionLoading').show();$('#predictionContent').hide();$('#predictionError').hide();const url=`/api/predict-match/${homeTeamId}/${awayTeamId}?home_name=${encodeURIComponent(homeTeamName)}&away_name=${encodeURIComponent(awayTeamName)}&force_update=true`;$.ajax({url:url,type:'GET',dataType:'json',success:function(data){window.displayPredictionData(data,homeTeamName,awayTeamName)},error:function(error){$('#predictionLoading').hide();$('#predictionError').text('Tahmin güncellenirken hata oluştu:'+error.responseJSON?.error||'Sunucu hatası').show()}})}function updatePredictionUI(data){console.log("updatePredictionUI çağrıldı");window.predictionData=data;$('#homeTeamName').text(data.home_team.name);$('#awayTeamName').text(data.away_team.name);console.log("Backend'den gelen tahmin verilerini doğrudan kullanıyorum...");if(data.predictions&&data.predictions.match_winner){const homeProb=Math.round(data.predictions.match_winner.home_win*100);const drawProb=Math.round(data.predictions.match_winner.draw*100);const awayProb=Math.round(data.predictions.match_winner.away_win*100);updateProbabilityBars(homeProb,drawProb,awayProb)}if(data.predictions){if(data.predictions.exact_score){$('#predictedScore').text(data.predictions.exact_score)}if(data.predictions.betting_predictions){const betting=data.predictions.betting_predictions;if(betting.both_teams_to_score){let bttsValue=betting.both_teams_to_score.prediction;const bttsProb=betting.both_teams_to_score.probability||0;if(bttsValue==='YES'){bttsValue='KG VAR'}else if(bttsValue==='NO'){bttsValue='KG YOK'}$('#bttsValue').text(bttsValue);$('#bttsProb').text(bttsProb.toFixed(2)+'%')}if(betting.over_2_5_goals){const overValue=betting.over_2_5_goals.prediction;const overProb=betting.over_2_5_goals.probability||0;$('#overValue').text(overValue);$('#overProb').text(overProb.toFixed(2)+'%')}if(betting.over_3_5_goals){const over35Value=betting.over_3_5_goals.prediction;const over35Prob=betting.over_3_5_goals.probability||0;$('#over35Value').text(over35Value);$('#over35Prob').text(over35Prob.toFixed(2)+'%')}}}updateMotivationUI(data)}function updateProbabilityBars(homeProb,drawProb,awayProb){$('#homeWinProb').text(homeProb+'%');$('#drawProb').text(drawProb+'%');$('#awayWinProb').text(awayProb+'%');$('#homeWinBar').css('width',homeProb+'%');$('#drawBar').css('width',drawProb+'%');$('#awayWinBar').css('width',awayProb+'%');$('.prob-bar').removeClass('highest-prob');if(homeProb>=drawProb&&homeProb>=awayProb){$('#homeWinBar').addClass('highest-prob')}else if(drawProb>=homeProb&&drawProb>=awayProb){$('#drawBar').addClass('highest-prob')}else{$('#awayWinBar').addClass('highest-prob')}}function updateMotivationUI(data){if(!data.home_team||!data.away_team)return;try{const homeForm=data.home_team.form.detailed_data.all.slice(0,5);const awayForm=data.away_team.form.detailed_data.all.slice(0,5);const homeFormHTML=createFormIcons(homeForm);const awayFormHTML=createFormIcons(awayForm);$('#homeTeamForm').html(homeFormHTML);$('#awayTeamForm').html(awayFormHTML)}catch(e){console.error("Form verileri gösterilirken hata:",e)}}function createFormIcons(matches){if(!matches||!matches.length)return '<span class="form-icon">-</span>';let formHTML='';for(let i=0;i<matches.length;i++){const match=matches[i];let result=match.result||'-';if(result==='W'){formHTML+='<span class="form-icon win">W</span>'}else if(result==='D'){formHTML+='<span class="form-icon draw">D</span>'}else if(result==='L'){formHTML+='<span class="form-icon loss">L</span>'}else{formHTML+='<span class="form-icon">-</span>'}}return formHTML}